nonsenseEngine.markov=function(){var a=function(a){return Math.floor(Math.random()*a)},b=function(b){var c=b,d=function(b){var d,e=0,f={},g=0;for(var h in c.children)h!==b&&h!=="__proto__"&&(f[h]=c.children[h],e+=f[h]);d=a(e);for(var h in f){g+=f[h];if(g>=d)return h}return null};return{attr:function(){return c},getChild:d}},c=function(){var a,b,c=[],d=function(a,d,e){var f=[];a||(a="__begin__"),d||(d=5);var g=b[a];for(;;){if(g.attr().sentence_end&&c.length>d+1)return f;a=g.getChild(e),a||(a="__begin__"),e=null,g=b[a],a!="__begin__"&&(f.push(g),c.push(g))}},e=function(){for(var a=0;a<arguments.length;a++)c.push(b[arguments[a]]);return c},f=function(a){var b=function(a){var b=0;for(var c in a)b+=1;return b};a||(a=2);var d=c.length-1,e=0,f=0;while(f<=a)f+=1,d-=1;e=b(c[d].attr().children);while(d>0&&e<3)d-=1,e=b(c[d].attr().children);return d},g=function(a){var b=c[a+1].attr().identifier;while(c.length>a+1)c.pop();return b},h=function(c){b={};for(var d in c.words)b[d]=nonsenseEngine.markov.word(c.words[d]);a&&a(l)},i=function(b,c){a=c,$.ajax({url:b,dataType:"json",success:function(a){h(a)}})},j=function(){return c.length>0?c[c.length-1]:b.__begin__},k=function(){return j().attr().identifier},l={words:function(){return b},length:function(){return c.length},lastWord:k,lastMarkovWord:j,load:i,seedWith:e,walkBackIndex:f,walkBack:g,genWords:d,initialize:h};return l},d=function(a,b,c){var d=b,f=a;e=c,walkBackIndex=0,maxLength=0,maxNumWords=75,retractDelay=2500,expandDelay=0;var g=function(){d.load(f,h)},h=function(){var a=d.seedWith("welcome","to","nonsense","engine",".");e.addWords(a);var b=e.appearAll();setTimeout(i,b+retractDelay)},i=function(){maxLength=d.length(),walkBackIndex=d.walkBackIndex(),maxLength>maxNumWords&&(maxLength=3,walkBackIndex=0);var a=e.walkBackDisplay(walkBackIndex);setTimeout(j,a+expandDelay)},j=function(){var a,b=d.walkBack(walkBackIndex),c=d.lastMarkovWord().attr().sentence_end;e.walkBack(walkBackIndex),console.log("Expanding - last word: "+d.lastWord()),a=d.genWords(d.lastWord(),maxLength,b),e.addWords(a,c);var f=e.appearAll();setTimeout(i,f+retractDelay)};return{start:g}},e=function(b){var c=b,d=0,e=["one","two","three","four"],f=[],g=function(b,d){$.each(b,function(b,g){var h=g.attr(),i=h.identifier;if(h.proper||d)i=l(i);a(h.count)<h.shout_count&&(i=i.toUpperCase()),h.punctuation||(i=" "+i),d=h.sentence_end;var j=$("<span>"+i+"</span>");j.addClass(e[0]),j.css("display","none"),c.append(j),f.push(j)}),h()},h=function(){var a=e.shift();e.push(a)},i=function(a){var b=0,c=300;for(var d=f.length-1;d>a;d--)f[d].delay(b).fadeOut(c),b+=50;return b+c},j=function(a){for(var b=f.length-1;b>a;b--)f[b].remove(),f.pop();d=a+1},k=function(){var a=0,b=1e3;for(;d<f.length;d++)f[d].delay(a).fadeIn(b),a+=200;return a+b},l=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},m=function(a,b){if(typeof a=="object")for(var c in a)n(c,b),c=="attr"&&typeof a.attr=="function"?m(a.attr(),b+1):m(a[c],b+1);else n(a,b)},n=function(a,b){var d="";for(var e=0;e<b;e++)d+="&nbsp;&nbsp;&nbsp;&nbsp;";c.append($("<p>"+d+a+"</p>"))};return{walkBackDisplay:i,walkBack:j,appearAll:k,addWords:g}};return{language:c,word:b,controller:d,display:e}}()